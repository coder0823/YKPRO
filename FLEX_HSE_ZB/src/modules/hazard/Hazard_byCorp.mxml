<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 width="400"
		 height="300"
		 xmlns:views="views.*"
		 creationComplete="init()">
	<!--
		 /* *
		 * 名称：总部仪表盘-隐患管理-分企业
		 * 参数：年月（2012-01）
		 * 作者：孙山虎
		 * 日期：2013年5月8日
		 * */
	-->
	<fx:Script>
		<![CDATA[
			import events.PopupEvent;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.effects.easing.Elastic;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			import skins.ButtonBarSkin;
			
			import spark.collections.Sort;
			import spark.collections.SortField;
			import spark.events.IndexChangeEvent;
			
			import views.PopupTitleWinDG;
			public const _dataPath:String = "assets/data/zb_hazarddata.xml";
			public const _wsdlPath:String = "assets/webserviceConf.xml";
			public const _dataType:String = "remoteWebservice"; //localStaticData   loccalXMLFile   remoteWebservice
			public const _showCorpCnt:int = 7;
			
			private var isFirstLoad:Boolean = true;
			private var dateStrChanged:Boolean = false;
			
			[Bindable]
			private var dateStr:String = "2013-05";
			private var dateStrName:String = "2013年05月";
			[Bindable]
			private var showDataLabel:Boolean=true;
			
			[Bindable]
			private var tab1_title:String = "企业项目进度及投资情况";
			[Bindable]
			private var tab2_title:String = "企业间对比情况";
			
			[Bindable]
			private var tab1_topLeftTitle:String = "";
			[Bindable]
			private var tab1_topRightTitle:String = "";
			[Bindable]
			private var tab1_downLeftTitle:String = "";
			[Bindable]
			private var tab1_downRightTitle:String = "";
			[Bindable]
			private var tab2_topLeftTitle:String = "";
			[Bindable]
			private var tab2_topRightTitle:String = "";
			[Bindable]
			private var tab2_downLeftTitle:String = "";
			[Bindable]
			private var tab2_downRightTitle:String = "";
			
			[Bindable]
			private var tab1_plateCurrSelect:String;
			private var tab1_plateNameCurrSelect:String;
			[Bindable]
			private var tab1_plateDS:ArrayCollection;
			[Bindable]
			private var tab1_corpCurrSelect:String;
			private var tab1_corpNameCurrSelect:String;
			[Bindable]
			private var tab1_corpDS:ArrayCollection;
			
			[Bindable]
			private var tab2_plateCurrSelect:String;
			private var tab2_plateNameCurrSelect:String;
			[Bindable]
			private var tab2_plateDS:ArrayCollection;
			[Bindable]
			private var tab2_levelCurrSelect:String;
			private var tab2_levelNameCurrSelect:String;
			[Bindable]
			private var tab2_levelDS:ArrayCollection;
			[Bindable]
			private var tab2_showCorpCnt:int = _showCorpCnt;
			[Bindable]
			private var tab2_showCorpCntMax:int = 1000;
			
			[Bindable]
			private var tab1_topLeftConfDS:ArrayCollection;
			[Bindable]
			private var tab1_topLeftDS:ArrayCollection;
			[Bindable]
			private var tab1_topRightConfDS:ArrayCollection;
			[Bindable]
			private var tab1_topRightDS:ArrayCollection;
			[Bindable]
			private var tab1_downLeftConfDS:ArrayCollection;
			[Bindable]
			private var tab1_downLeftDS:ArrayCollection;
			[Bindable]
			private var tab1_downRightConfDS:ArrayCollection;
			[Bindable]
			private var tab1_downRightDS:ArrayCollection;
			
			[Bindable]
			private var tab2_topLeftConfDS:ArrayCollection;
			[Bindable]
			private var tab2_topLeftDS:ArrayCollection;
			[Bindable]
			private var tab2_topRightConfDS:ArrayCollection;
			[Bindable]
			private var tab2_topRightDS:ArrayCollection;
			[Bindable]
			private var tab2_downLeftConfDS:ArrayCollection;
			[Bindable]
			private var tab2_downLeftDS:ArrayCollection;
			[Bindable]
			private var tab2_downRightConfDS:ArrayCollection;
			[Bindable]
			private var tab2_downRightDS:ArrayCollection;
			
			private var loader_wsdl:URLLoader = new URLLoader();
			private var loader:URLLoader = new URLLoader();
			
			private var keys1:Array =new Array();
			
			
			protected function init():void
			{
				tab1_topLeftDS = new ArrayCollection();
				tab1_topRightDS = new ArrayCollection();
				tab1_downLeftDS = new ArrayCollection();
				tab1_downRightDS = new ArrayCollection();
				
				tab2_topLeftDS = new ArrayCollection();
				tab2_topRightDS = new ArrayCollection();
				tab2_downLeftDS = new ArrayCollection();
				tab2_downRightDS = new ArrayCollection();
				
				tab1_topLeftConfDS = new ArrayCollection([{name: "正在设计", field: "sub1"}, {name: "等待施工", field: "sub2"}, {name: "正在施工", field: "sub3"}, {name: "已完成", field: "sub4"}]);
				tab1_downLeftConfDS = new ArrayCollection([{name: "正在设计", field: "sub1"}, {name: "等待施工", field: "sub2"}, {name: "正在施工", field: "sub3"}, {name: "已完成", field: "sub4"}]);
				tab1_topRightConfDS = new ArrayCollection([{name: "完成投资", field: "sub1"}, {name: "未完成投资", field: "sub2"}]);
				tab1_downRightConfDS = new ArrayCollection([{name: "完成投资", field: "sub1"}, {name: "未完成投资", field: "sub2"}]);
				
				tab2_topLeftConfDS = new ArrayCollection([{name: "进度完成率", field: "vol1", type: "columnSeries", axis: "left"}, {name: "平均进度完成率", field: "vol2", type: "lineSeries", axis: "left", showLabel: "0"},]);
				tab2_topRightConfDS = new ArrayCollection([{name: "进度完成率", field: "vol1", type: "columnSeries", axis: "left"}, {name: "平均进度完成率", field: "vol2", type: "lineSeries", axis: "left", showLabel: "0"},]);
				tab2_downLeftConfDS = new ArrayCollection([{name: "完成率", field: "vol1", type: "columnSeries", axis: "left"}, {name: "平均完成率", field: "vol2", type: "lineSeries", axis: "left", showLabel: "0"}]);
				tab2_downRightConfDS = new ArrayCollection([{name: "完成率", field: "vol1", type: "columnSeries", axis: "left"}, {name: "平均完成率", field: "vol2", type: "lineSeries", axis: "left", showLabel: "0"}]);
				
				refreshData();
				isFirstLoad = false;
				tab1_corpRep.setStyle("rollOverColor","haloBlue");
				this.addEventListener(KeyboardEvent.KEY_DOWN, keyDownHandle);
			}
			
			private function keyDownHandle(event:KeyboardEvent):void
			{
				if (event.charCode == 13)
					search_clickHandler();
			}
			
			private function refreshData():void
			{
				switch (_dataType)
				{
					case "remoteWebservice": 
						loadWSDL();
						break;
					case "loccalXMLFile": 
						loadData();
						break;
					case "localStaticData": 
						loadDemo();
						break;
				}
			}
			
			private function loadDemo():void
			{
				Alert.show("您现在浏览的为（静态）测试数据");
				//。。。。。。。。
			}
			
			private function loadWSDL():void
			{
				loader_wsdl.load(new URLRequest(this._wsdlPath));
				loader_wsdl.addEventListener(Event.COMPLETE, loader_wsdl_result_handler);
			}
			
			private function loader_wsdl_result_handler(event:Event):void
			{
				ws_init();
			}
			
			private function ws_init():void
			{
				try
				{
					ws.wsdl = XML(loader_wsdl.data).url;
					ws.loadWSDL();
					ws.GetHazard(dateStr, 'all', '', '', '');
				}
				catch (e:Event)
				{
					Alert.show("请检查WEBSERVICE配置文件，在./assets/webserviceConf.xml中");
				}
			}
			
			protected function ws_resultHandler(event:ResultEvent):void
			{
				hseDataXML = XML(event.result);
				executeBind();
			}
			
			protected function ws_faultHandler(event:FaultEvent):void
			{
				trace(event);
			}
			
			private function loadData():void
			{
				Alert.show("您现在浏览的为（本地XML）测试数据");
				loader.load(new URLRequest(this._dataPath));
				loader.addEventListener(Event.COMPLETE, loadDataHandler);
			}
			
			private function loadDataHandler(event:Event):void
			{
				hseDataXML = XML(loader.data);
				executeBind();
			}
			
			private function executeBind():void
			{
				tab1_plateDS = gettab1_plateDS();
				tab1_corpDS = getTab1_corpDS();
				tab2_plateDS = gettab2_plateDS();
				
				tab2_showCorpCnt = getTab2_CorpCntDS();
				tab2_showCorpCntMax = getTab2_CorpCntMax();
				
				tab1_topLeftDS = gettab1_topLeftDS();
				tab1_topRightDS = gettab1_topRightDS();
				tab1_downLeftDS = gettab1_downLeftDS();
				tab1_downRightDS = gettab1_downRightDS();
				
				tab2_topLeftDS = gettab2_topLeftDS();
				tab2_topRightDS = gettab2_topRightDS();
				tab2_downLeftDS = gettab2_downLeftDS();
				tab2_downRightDS = gettab2_downRightDS();
				
				executeBindTab1Title();
				executeBindTab2Title();
			}
			
			private function executeBindTab1Title():void
			{
				if(tab1_corpDS.length>0){
					tab1_topLeftTitle = tab1_corpNameCurrSelect + "" + dateStrName + "隐患项目进度情况(个)";
					tab1_topRightTitle = tab1_corpNameCurrSelect + "" + dateStrName + "隐患项目投资完成情况(万元)";
				}else{
					tab1_topLeftTitle = "隐患项目进度情况(个)";
					tab1_topRightTitle = "隐患项目投资完成情况(万元)";
				}
				
				tab1_downLeftTitle = "";
				tab1_downRightTitle = "";
			}
			
			private function executeBindTab2Title():void
			{
				if(tab2_plateNameCurrSelect=="全部"){
				     tab2_topLeftTitle =   "中国石化" + dateStrName + "企业隐患治理项目进度完成率（前" + tab2_showCorpCnt + "名）";
				     tab2_topRightTitle =  "中国石化"+ dateStrName + "企业隐患治理项目进度完成率（后" + tab2_showCorpCnt + "名）";
				     tab2_downLeftTitle =  "中国石化" + dateStrName + "企业隐患治理项目投资完成率（前" + tab2_showCorpCnt + "名）";
				     tab2_downRightTitle = "中国石化" + dateStrName + "企业隐患治理项目投资完成率（后" + tab2_showCorpCnt + "名）";
				}
				else{
					tab2_topLeftTitle = tab2_plateNameCurrSelect + "板块" + dateStrName + "企业隐患治理项目进度完成率（前" + tab2_showCorpCnt + "名）";
					tab2_topRightTitle = tab2_plateNameCurrSelect + "板块" + dateStrName + "企业隐患治理项目进度完成率（后" + tab2_showCorpCnt + "名）";
					tab2_downLeftTitle = tab2_plateNameCurrSelect + "板块" + dateStrName + "企业隐患治理项目投资完成率（前" + tab2_showCorpCnt + "名）";
					tab2_downRightTitle = tab2_plateNameCurrSelect + "板块" + dateStrName + "企业隐患治理项目投资完成率（后" + tab2_showCorpCnt + "名）";
				}
			}
			
			private function gettab1_plateDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					tab1_plateCurrSelect = "00"; //设置默认选择
					tab1_plateNameCurrSelect = "全部";
					tmpArrayCollection.addItem({label: "全部", value: "00"});
					tmpArrayCollection.addItem({label: "油田", value: "YT"});
					tmpArrayCollection.addItem({label: "炼化", value: "LH"});
					tmpArrayCollection.addItem({label: "销售", value: "XS"});
					tmpArrayCollection.addItem({label: "工程", value: "GC"});
					tmpArrayCollection.addItem({label: "其他", value: "QT"});
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function getTab1_corpDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				var tmpArrayCollection_temp:ArrayCollection = new ArrayCollection();
			 var filteredArr:Array=new Array();
				try
				{
					var yearid:String = dateStr;
					var tmpList:XMLList;
					if (tab1_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL").plateData.corpData;
					}
					else
					{
						tmpList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL").plateData.(@plateid == tab1_plateCurrSelect).corpData;
					}
					if (tmpList.length() > 0)
					{
						tab1_corpCurrSelect = tmpList[0].@subCorpid; //设置默认选择
						tab1_corpNameCurrSelect = tmpList[0].@subCorpname;
						tab1_corpNameCurrSelect = tab1_corpNameCurrSelect == null ? "" : tab1_corpNameCurrSelect;
						if (tmpList.length() > 0)
						{
							for each (var xml:XML in tmpList)
							{
								var obj:Object = new Object();//{label: xml.@subCorpname, value: xml.@subCorpid};
								obj.label = xml.@subCorpname;
								obj.value = xml.@subCorpid+'';
								tmpArrayCollection.addItem(obj);
							}
						}
					}
					
				}
				catch (e:Event)
				{
					trace(e);
				}
				keys1 =new Array();
				filteredArr = tmpArrayCollection.source.filter(removedDuplicates);
				for(var i:int=0;i<filteredArr.length;i++){
					var obj_temp:Object = new Object();
					obj_temp.label = filteredArr[i].label;
					obj_temp.value = filteredArr[i].value;
					tmpArrayCollection_temp.addItem(obj_temp);
				}
				return tmpArrayCollection_temp;
			
			}
			
			private function removedDuplicates(item:*, idx:uint, arr:Array):Boolean {
				if (keys1.indexOf(arr[idx].value)!=-1) {
					return false;
				} else {               
					keys1.push(arr[idx].value);
					return true;
				}
			} 
			
			private function gettab2_plateDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					tab2_plateCurrSelect = "00"; //设置默认选择
					tab2_plateNameCurrSelect = "全部";
					tmpArrayCollection.addItem({label: "全部", value: "00"});
					tmpArrayCollection.addItem({label: "油田", value: "YT"});
					tmpArrayCollection.addItem({label: "炼化", value: "LH"});
					tmpArrayCollection.addItem({label: "销售", value: "XS"});
					tmpArrayCollection.addItem({label: "工程", value: "GC"});
					tmpArrayCollection.addItem({label: "其他", value: "QT"});
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function getTab2_CorpCntDS():int
			{
				var _cnt:int = getTab2_CorpCntMax();
				if (_cnt > _showCorpCnt)
					_cnt = _showCorpCnt;
				return _cnt;
			}
			
			private function getTab2_CorpCntMax():int
			{
				var _cnt:int = 0;
				try
				{
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.projectdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).projectdata.corpData;
					}
					
					if (tmpList != null && tmpList.length() > 0)
					{
						_cnt = tmpList.length();
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				//分左右2部分显示
				_cnt = Math.floor((_cnt + 1) / 2);
				return _cnt;
			}
			
			private function gettab1_topLeftDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList;
					if (tab1_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL").plateData.corpData.(@subCorpid == tab1_corpCurrSelect);
					}
					else
					{
						tmpList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL").plateData.(@plateid == tab1_plateCurrSelect).corpData.(@subCorpid == tab1_corpCurrSelect);
					}
					
					if (tmpList.length() > 0)
					{
						var sum_all:Number = 0;
						var sum_in_designer:Number = 0;
						var sum_wait_construction:Number = 0;
						var sum_in_construction:Number = 0;
						var sum_finished:Number = 0;
						for each (var xml:XML in tmpList)
						{
							var xml_in_designer:XMLList = xml.projectdata.(@id == "in-designer");
							var xml_wait_construction:XMLList = xml.projectdata.(@id == "wait-construction");
							var xml_in_construction:XMLList = xml.projectdata.(@id == "in-construction");
							var xml_finished:XMLList = xml.projectdata.(@id == "finished");
							
							if (xml_in_designer && xml_in_designer.length() > 0)
							{
								for each (var xml_1:XML in xml_in_designer)
								{
									sum_all += Number(xml_1.@numbers);
									sum_in_designer += Number(xml_1.@numbers)
								}
							}
							if (xml_wait_construction && xml_wait_construction.length() > 0)
							{
								for each (var xml_2:XML in xml_wait_construction)
								{
									sum_all += Number(xml_2.@numbers);
									sum_wait_construction += Number(xml_2.@numbers)
								}
							}
							if (xml_in_construction && xml_in_construction.length() > 0)
							{
								for each (var xml_3:XML in xml_in_construction)
								{
									sum_all += Number(xml_3.@numbers);
									sum_in_construction += Number(xml_3.@numbers)
								}
							}
							if (xml_finished && xml_finished.length() > 0)
							{
								for each (var xml_4:XML in xml_finished)
								{
									sum_all += Number(xml_4.@numbers);
									sum_finished += Number(xml_4.@numbers)
								}
							}
						}
						var obj:Object = {label: "合计", total: sum_all, sub1: sum_in_designer, sub2: sum_wait_construction, sub3: sum_in_construction, sub4: sum_finished, msgFirst: "", msgLast: "", id: xml.@typeid};
						
						//格式化数据
						obj.total = Number(obj.total) < 0 ? 0 : obj.total;
						obj.sub1 = Number(obj.sub1) < 0 ? 0 : obj.sub1;
						obj.sub2 = Number(obj.sub2) < 0 ? 0 : obj.sub2;
						obj.sub3 = Number(obj.sub3) < 0 ? 0 : obj.sub3;
						obj.sub4 = Number(obj.sub4) < 0 ? 0 : obj.sub4;
						
						tmpArrayCollection.addItem(obj);
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function gettab1_topRightDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList;
					if (tab1_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL").plateData.corpData.(@subCorpid == tab1_corpCurrSelect);
					}
					else
					{
						tmpList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL").plateData.(@plateid == tab1_plateCurrSelect).corpData.(@subCorpid == tab1_corpCurrSelect);
					}
					
					if (tmpList.length() > 0)
					{
						var sum_investment:Number = 0;
						var sum_finishedInvestment:Number = 0;
						var sum_unfinishedInvestment:Number = 0;
						
						for each (var xml:XML in tmpList)
						{
							sum_finishedInvestment += Number(xml.@finishedInvestment);
							sum_unfinishedInvestment += Number(xml.@unfinishedInvestment);
							sum_investment += Number(xml.@investment);
						}
						var obj:Object = {label: "合计", total: sum_investment, sub1: sum_finishedInvestment, sub2: sum_unfinishedInvestment, msgFirst: "", msgLast: "", id: xml.@typeid};
						
						//格式化数据
						obj.total = Number(obj.total) < 0 ? 0 : obj.total;
						obj.sub1 = Number(obj.sub1) < 0 ? 0 : obj.sub1;
						obj.sub2 = Number(obj.sub2) < 0 ? 0 : obj.sub2;
						
						tmpArrayCollection.addItem(obj);
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function gettab1_downLeftDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL");
					if (tmpList != null && tmpList.length() > 0)
					{
						for each (var xml:XML in tmpList)
						{
							var tmpList2:XMLList;
							if (tab1_plateCurrSelect == "00")
							{
								tmpList2 = xml.plateData.corpData.(@subCorpid == tab1_corpCurrSelect);
							}
							else
							{
								tmpList2 = xml.plateData.(@plateid == tab1_plateCurrSelect).corpData.(@subCorpid == tab1_corpCurrSelect);
							}
							if (tmpList2 != null && tmpList2.length() > 0)
							{
								var sum_all:Number = 0;
								var sum_in_designer:Number = 0;
								var sum_wait_construction:Number = 0;
								var sum_in_construction:Number = 0;
								var sum_finished:Number = 0;
								for each (var xml2:XML in tmpList2)
								{
									var xml_in_designer:XMLList = xml2.projectdata.(@id == "in-designer");
									var xml_wait_construction:XMLList = xml2.projectdata.(@id == "wait-construction");
									var xml_in_construction:XMLList = xml2.projectdata.(@id == "in-construction");
									var xml_finished:XMLList = xml2.projectdata.(@id == "finished");
									
									if (xml_in_designer && xml_in_designer.length() > 0)
									{
										for each (var xml_1:XML in xml_in_designer)
										{
											sum_all += Number(xml_1.@numbers);
											sum_in_designer += Number(xml_1.@numbers)
										}
									}
									if (xml_wait_construction && xml_wait_construction.length() > 0)
									{
										for each (var xml_2:XML in xml_wait_construction)
										{
											sum_all += Number(xml_2.@numbers);
											sum_wait_construction += Number(xml_2.@numbers)
										}
									}
									if (xml_in_construction && xml_in_construction.length() > 0)
									{
										for each (var xml_3:XML in xml_in_construction)
										{
											sum_all += Number(xml_3.@numbers);
											sum_in_construction += Number(xml_3.@numbers)
										}
									}
									if (xml_finished && xml_finished.length() > 0)
									{
										for each (var xml_4:XML in xml_finished)
										{
											sum_all += Number(xml_4.@numbers);
											sum_finished += Number(xml_4.@numbers)
										}
									}
									
								}
								var obj:Object = {label: xml.@label, total: sum_all, sub1: (xml_in_designer != null && xml_in_designer.length() > 0) ? xml_in_designer[0].@numbers : 0, sub2: (xml_wait_construction != null && xml_wait_construction.length() > 0) ? xml_wait_construction[0].@numbers : 0, sub3: (xml_in_construction != null && xml_in_construction.length() > 0) ? xml_in_construction[0].@numbers : 0, sub4: (xml_finished != null && xml_finished.length() > 0) ? xml_finished[0].@numbers : 0, msgFirst: "", msgLast: "", id: xml.@typeid};
								
								//格式化数据
								obj.total = Number(obj.total) < 0 ? 0 : obj.total;
								obj.sub1 = Number(obj.sub1) < 0 ? 0 : obj.sub1;
								obj.sub2 = Number(obj.sub2) < 0 ? 0 : obj.sub2;
								obj.sub3 = Number(obj.sub3) < 0 ? 0 : obj.sub3;
								obj.sub4 = Number(obj.sub4) < 0 ? 0 : obj.sub4;
								
								tmpArrayCollection.addItem(obj);
							}
							
						}
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function gettab1_downRightDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList = hseDataXML.hazardData.dataset.(@typeid == "GROUP-LEVEL")
					if (tmpList != null && tmpList.length() > 0)
					{
						for each (var xml:XML in tmpList)
						{
							var tmpList2:XMLList;
							if (tab1_plateCurrSelect == "00")
							{
								tmpList2 = xml.plateData.corpData.(@subCorpid == tab1_corpCurrSelect);
							}
							else
							{
								tmpList2 = xml.plateData.(@plateid == tab1_plateCurrSelect).corpData.(@subCorpid == tab1_corpCurrSelect);
							}
							if (tmpList2 != null && tmpList2.length() > 0)
							{
								var sum_investment:Number = 0;
								var sum_finishedInvestment:Number = 0;
								var sum_unfinishedInvestment:Number = 0;
								for each (var xml2:XML in tmpList2)
								{
									sum_finishedInvestment += Number(xml2.@finishedInvestment);
									sum_unfinishedInvestment += Number(xml2.@unfinishedInvestment);
									sum_investment += Number(xml2.@investment);
								}
								var obj:Object = {label: xml.@label, total: sum_investment, sub1: sum_finishedInvestment, sub2: sum_unfinishedInvestment, msgFirst: "", msgLast: "", id: xml.@typeid};
								
								//格式化数据
								obj.total = Number(obj.total) < 0 ? 0 : obj.total;
								obj.sub1 = Number(obj.sub1) < 0 ? 0 : obj.sub1;
								obj.sub2 = Number(obj.sub2) < 0 ? 0 : obj.sub2;
								
								tmpArrayCollection.addItem(obj);
							}
						}
					}
					
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function gettab2_topLeftDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.projectdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).projectdata.corpData;
					}
					if (tmpList.length() > 0)
					{
						for each (var xml:XML in tmpList)
						{
							var obj:Object = {label: xml.@subCorpname, vol1: xml.@progressRate, vol2: xml.@averageProgressRate, msgFirst: "", msgLast: "", id: xml.@typeid};
							
							//格式化数据
							obj.vol1 = Number(obj.vol1) > 100 ? 100 : obj.vol1;
							obj.vol2 = Number(obj.vol2) > 100 ? 100 : obj.vol2;
							
							tmpArrayCollection.addItem(obj);
						}
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				var sort:Sort = new Sort();
				sort.fields = [new SortField("vol1", true, true)];
				tmpArrayCollection.sort = sort;
				tmpArrayCollection.refresh();
				
				//筛选记录数，由于先筛选再排序，造成数据不准，所以这里再排序之后进行筛选
				var tmpArrayCollection2:ArrayCollection = new ArrayCollection();
				var tmpCnt:int = 0;
				for (var i:int = 0; i < tmpArrayCollection.length; i++)
				{
					if (i >= tab2_showCorpCnt)
						break;
					tmpArrayCollection2.addItem(tmpArrayCollection.getItemAt(i));
				}
				
				return tmpArrayCollection2;
			}
			
			private function gettab2_topRightDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.projectdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).projectdata.corpData;
					}
					if (tmpList.length() > 0)
					{
						for each (var xml:XML in tmpList)
						{
							var obj:Object = {label: xml.@subCorpname, vol1: xml.@progressRate, vol2: xml.@averageProgressRate, msgFirst: "", msgLast: "", id: xml.@typeid};
							
							//格式化数据
							obj.vol1 = Number(obj.vol1) > 100 ? 100 : obj.vol1;
							obj.vol2 = Number(obj.vol2) > 100 ? 100 : obj.vol2;
							
							tmpArrayCollection.addItem(obj);
						}
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				var sort:Sort = new Sort();
				sort.fields = [new SortField("vol1", false, true)];
				tmpArrayCollection.sort = sort;
				tmpArrayCollection.refresh();
				
				//筛选记录数，由于先筛选再排序，造成数据不准，所以这里再排序之后进行筛选
				var tmpArrayCollection2:ArrayCollection = new ArrayCollection();
				var tmpCnt:int = 0;
				for (var j:int = 0; j < tmpArrayCollection.length; j++)
				{
					if (j >= tab2_showCorpCnt)
						break;
					tmpArrayCollection2.addItem(tmpArrayCollection.getItemAt(j));
				}
				
				return tmpArrayCollection2;
			}
			
			private function gettab2_downLeftDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.investmentdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).investmentdata.corpData;
					}
					if (tmpList.length() > 0)
					{
						for each (var xml:XML in tmpList)
						{
							var obj:Object = {label: xml.@subCorpname, vol1: xml.@finishedRation, vol2: xml.@averageFinishedRation, msgFirst: "", msgLast: "", id: xml.@typeid};
							
							//格式化数据
							obj.vol1 = Number(obj.vol1) > 100 ? 100 : obj.vol1;
							obj.vol2 = Number(obj.vol2) > 100 ? 100 : obj.vol2;
							
							tmpArrayCollection.addItem(obj);
						}
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				var sort:Sort = new Sort();
				sort.fields = [new SortField("vol1", true, true)];
				tmpArrayCollection.sort = sort;
				tmpArrayCollection.refresh();
				
				//筛选记录数，由于先筛选再排序，造成数据不准，所以这里再排序之后进行筛选
				var tmpArrayCollection2:ArrayCollection = new ArrayCollection();
				var tmpCnt:int = 0;
				for (var i:int = 0; i < tmpArrayCollection.length; i++)
				{
					if (i >= tab2_showCorpCnt)
						break;
					tmpArrayCollection2.addItem(tmpArrayCollection.getItemAt(i));
				}
				
				return tmpArrayCollection2;
			}
			
			private function gettab2_downRightDS():ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.investmentdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).investmentdata.corpData;
					}
					
					if (tmpList.length() > 0)
					{
						for each (var xml:XML in tmpList)
						{
							var obj:Object = {label: xml.@subCorpname, vol1: xml.@finishedRation, vol2: xml.@averageFinishedRation, msgFirst: "", msgLast: "", id: xml.@typeid};
							
							//格式化数据
							obj.vol1 = Number(obj.vol1) > 100 ? 100 : obj.vol1;
							obj.vol2 = Number(obj.vol2) > 100 ? 100 : obj.vol2;
							
							tmpArrayCollection.addItem(obj);
						}
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				var sort:Sort = new Sort();
				sort.fields = [new SortField("vol1", false, true)];
				tmpArrayCollection.sort = sort;
				tmpArrayCollection.refresh();
				
				//筛选记录数，由于先筛选再排序，造成数据不准，所以这里再排序之后进行筛选
				var tmpArrayCollection2:ArrayCollection = new ArrayCollection();
				var tmpCnt:int = 0;
				for (var j:int = 0; j < tmpArrayCollection.length; j++)
				{
					if (j >= tab2_showCorpCnt)
						break;
					tmpArrayCollection2.addItem(tmpArrayCollection.getItemAt(j));
				}
				
				return tmpArrayCollection2;
			}
			private var titleWindow:views.PopupTitleWinDG;
			
			private function popupMX():void
			{
				titleWindow = new views.PopupTitleWinDG();
				titleWindow.TitleValue = tab1_corpNameCurrSelect + "" + "隐患治理情况" + "(" + dateStrName + ")";
				titleWindow.addEventListener(CloseEvent.CLOSE, function closeEV():void
					{
						PopUpManager.removePopUp(titleWindow);
					});
				titleWindow.IfShowFirstRecordBgColor = true;
				titleWindow.IfShowFrontRecordColor = false;
				titleWindow.IfShowBackRecordColor = false;
				titleWindow.DataSourceConf = new ArrayCollection([{headerText: "隐患级别", dataField: "label", width: "100", textAlign: "left", sortable: true, draggable: true}, {headerText: "项目数", dataField: "vol1", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "总投资", dataField: "vol2", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "完成投资", dataField: "vol3", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "投资完成率%", dataField: "vol4", width: "60", textAlign: "center", sortable: true, draggable: true}, {headerText: "正在设计", dataField: "vol5", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "等待施工", dataField: "vol6", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "正在施工", dataField: "vol7", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "完成", dataField: "vol8", width: "50", textAlign: "center", sortable: true, draggable: true},]);
				
				try
				{
					var tmpArrayCollection:ArrayCollection = new ArrayCollection();
					var tmpList:XMLList = hseDataXML.hazardData.dataset;
					
					var xml_total:XMLList = tmpList.(@typeid == 'GROUP-LEVEL').plateData.corpData.(@subCorpid == tab1_corpCurrSelect);
					var xml_group:XMLList = tmpList.(@typeid == 'GROUP-LEVEL');
					var ac:ArrayCollection;
					var index:int = 1;
					ac = getWinACItem_all(xml_total, tab1_corpNameCurrSelect + "小计");
					if (ac != null && ac.length > 0)
					{
						for each (var obj_1:Object in ac)
						{
							obj_1.index = index;
							index++;
							tmpArrayCollection.addItem(obj_1);
						}
					}
					
					if (xml_group != null && xml_group.length() > 0)
					{
						for each (var xml:XML in xml_group)
						{
							var tmp_xml_group:XMLList = xml.plateData.corpData.(@subCorpid == tab1_corpCurrSelect);
							ac = getWinACItem(tmp_xml_group, xml.@label);
							if (ac != null && ac.length > 0)
							{
								for each (var obj_2:Object in ac)
								{
									obj_2.index = index;
									index++;
									tmpArrayCollection.addItem(obj_2);
								}
							}
						}
					}
					
					titleWindow.DataSource = tmpArrayCollection;
				}
				catch (e:Event)
				{
					trace(e);
				}
				
				PopUpManager.addPopUp(titleWindow, this, true);
				PopUpManager.centerPopUp(titleWindow);
			}
			
			protected function getWinACItem_all(xml_total:XMLList, label:String):ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					if (xml_total.length() > 0)
					{
						var sum:Number = 0;
						
						var sum_tz:Number = 0;
						var sum_finish:Number = 0;
						var ratio_tz:Number = 0;
						var vol5:Number = 0;
						var vol6:Number = 0;
						var vol7:Number = 0;
						var vol8:Number = 0;
						
						if (xml_total.projectdata && xml_total.projectdata.length() > 0)
						{
							
							for each (var xml_sum:XML in xml_total.projectdata)
							{
								sum += Number(xml_sum.@numbers);
							}
							for each (var xml:XML in xml_total)
							{
								sum_tz += Number(xml.@finishedInvestment) + Number(xml.@unfinishedInvestment);
								sum_finish += Number(xml.@finishedInvestment);
								var xml_in_designer:XMLList = xml.projectdata.(@id == "in-designer");
								var xml_wait_construction:XMLList = xml.projectdata.(@id == "wait-construction");
								var xml_in_construction:XMLList = xml.projectdata.(@id == "in-construction");
								var xml_finished:XMLList = xml.projectdata.(@id == "finished");
								vol5 += (xml_in_designer != null && xml_in_designer.length() > 0) ? Number(xml_in_designer[0].@numbers) : 0;
								vol6 += (xml_wait_construction != null && xml_wait_construction.length() > 0) ? Number(xml_wait_construction[0].@numbers) : 0;
								vol7 += (xml_in_construction != null && xml_in_construction.length() > 0) ? Number(xml_in_construction[0].@numbers) : 0;
								vol8 += (xml_finished != null && xml_in_designer.length() > 0 && xml_finished.length() > 0) ? Number(xml_finished[0].@numbers) : 0;
							}
							ratio_tz = sum_tz == 0 ? 0 : sum_finish * 100 / sum_tz;
							sum_tz = Number(sum_tz.toFixed(2));
							ratio_tz = Number(ratio_tz.toFixed(2));
							sum_finish = Number(sum_finish.toFixed(2));
							
							var obj:Object = {label: label, vol1: sum, vol2: sum_tz, vol3: sum_finish, 
								vol4: ratio_tz, vol5:vol5, 
									vol6:vol6, 
									vol7:vol7, 
									vol8:vol8};
							tmpArrayCollection.addItem(obj);
						}
					}
						
					
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			protected function getWinACItem(xml_total:XMLList, label:String):ArrayCollection
			{
				var tmpArrayCollection:ArrayCollection = new ArrayCollection();
				try
				{
					if (xml_total.length() > 0)
					{
						for each (var xml:XML in xml_total)
						{
							
							if (xml.projectdata && xml.projectdata.length() > 0)
							{
								var sum:Number = 0;
								for each (var xml_sum:XML in xml.projectdata)
								{
									sum += Number(xml_sum.@numbers);
								}
								var sum_tz:Number = Number(xml.@finishedInvestment) + Number(xml.@unfinishedInvestment);
								var ratio_tz:Number = sum_tz == 0 ? 0 : Number(xml.@finishedInvestment) * 100 / sum_tz;
								var xml_in_designer:XMLList = xml.projectdata.(@id == "in-designer");
								var xml_wait_construction:XMLList = xml.projectdata.(@id == "wait-construction");
								var xml_in_construction:XMLList = xml.projectdata.(@id == "in-construction");
								var xml_finished:XMLList = xml.projectdata.(@id == "finished");
								
								sum_tz = Number(sum_tz.toFixed(2));
								ratio_tz = Number(ratio_tz.toFixed(2));
								
								var obj:Object = {label: label, vol1: sum, vol2: sum_tz, vol3: Number(xml.@finishedInvestment), 
									vol4: ratio_tz, vol5: (xml_in_designer != null && xml_in_designer.length() > 0) ? Number(xml_in_designer[0].@numbers) : 0, 
										vol6: (xml_wait_construction != null && xml_wait_construction.length() > 0) ? Number(xml_wait_construction[0].@numbers) : 0, 
										vol7: (xml_in_construction != null && xml_in_construction.length() > 0) ? Number(xml_in_construction[0].@numbers) : 0, 
										vol8: (xml_finished != null && xml_in_designer.length() > 0 && xml_finished.length() > 0) ? Number(xml_finished[0].@numbers) : 0};
								tmpArrayCollection.addItem(obj);
							}
						}
					}
				}
				catch (e:Event)
				{
					trace(e);
				}
				return tmpArrayCollection;
			}
			
			private function popupMX2_proj():void
			{
				titleWindow = new views.PopupTitleWinDG();
				titleWindow.TitleValue = tab2_plateNameCurrSelect + "" + "隐患治理项目进度情况" + "(" + dateStrName + ")";
				titleWindow.addEventListener(CloseEvent.CLOSE, function closeEV():void
					{
						PopUpManager.removePopUp(titleWindow);
					});
				titleWindow.IfShowFirstRecordBgColor = true;
				titleWindow.IfShowFrontRecordColor = true;
				titleWindow.IfShowBackRecordColor = true;
				titleWindow.DataSourceConf = new ArrayCollection([{headerText: "企业", dataField: "label", width: "100", textAlign: "center", sortable: true, draggable: true}, {headerText: "项目数", dataField: "vol1", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "正在设计", dataField: "vol2", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "等待施工", dataField: "vol3", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "正在施工", dataField: "vol4", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "完成", dataField: "vol5", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "进度完成率(%)", dataField: "vol6", width: "50", textAlign: "center", sortable: true, draggable: true}, {headerText: "平均进度完成率(%)", dataField: "vol7", width: "50", textAlign: "center", sortable: true, draggable: true}]);
				
				try
				{
					var tmpArrayCollection:ArrayCollection = new ArrayCollection();
					var tmpArrayCollection2:ArrayCollection = new ArrayCollection();
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.projectdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).projectdata.corpData;
					}
					
					if (tmpList != null && tmpList.length() > 0)
					{
						var vol1_sum:Number = 0;
						var vol2_sum:Number = 0;
						var vol3_sum:Number = 0;
						var vol4_sum:Number = 0;
						var vol5_sum:Number = 0;
						var vol6_sum:Number = 0;
						var vol7_sum:Number = 0;
						var index:int = 2;
						for each (var xml:XML in tmpList)
						{
							var obj:Object = {label: xml.@subCorpname, vol1: Number(xml.@numbers), vol2: Number(xml.@inDesigner), vol3: Number(xml.@waitConstruction), vol4: Number(xml.@inConstruction), vol5: Number(xml.@finished), vol6: Number(xml.@progressRate), vol7: Number(xml.@averageProgressRate), index: index}
							tmpArrayCollection.addItem(obj);
							index++;
							
							vol1_sum += Number(obj.vol1);
							vol2_sum += Number(obj.vol2);
							vol3_sum += Number(obj.vol3);
							vol4_sum += Number(obj.vol4);
							vol5_sum += Number(obj.vol5);
						}
						vol6_sum = (vol1_sum == 0) ? 0 : vol5_sum * 100 / vol1_sum;
						vol6_sum = Number(vol6_sum.toFixed(2));
						
						var obj_total:Object = {label: tab2_plateNameCurrSelect + "合计", vol1: vol1_sum, vol2: vol2_sum, vol3: vol3_sum, vol4: vol4_sum, vol5: vol5_sum, vol6: vol6_sum, vol7: vol6_sum, index: 1}
						tmpArrayCollection2.addItem(obj_total);
						
						var sort:Sort = new Sort();
						sort.fields = [new SortField("vol6", true, true)];
						tmpArrayCollection.sort = sort;
						tmpArrayCollection.refresh();
						
						var order2:int = 1;
						for each (var obj2:Object in tmpArrayCollection)
						{
							obj2.order = order2;
							tmpArrayCollection2.addItem(obj2);
							order2++;
						}
					}
					
					titleWindow.DataSource = tmpArrayCollection2;
				}
				catch (e:Event)
				{
					trace(e);
				}
				
				PopUpManager.addPopUp(titleWindow, this, true);
				PopUpManager.centerPopUp(titleWindow);
			}
			
			private function popupMX2_investment():void
			{
				titleWindow = new views.PopupTitleWinDG();
				titleWindow.TitleValue = tab2_plateNameCurrSelect + "" + "隐患治理项目投资完成率" + "(" + dateStrName + ")";
				titleWindow.addEventListener(CloseEvent.CLOSE, function closeEV():void
					{
						PopUpManager.removePopUp(titleWindow);
					});
				titleWindow.IfShowFirstRecordBgColor = true;
				titleWindow.IfShowFrontRecordColor = true;
				titleWindow.IfShowBackRecordColor = true;
				titleWindow.DataSourceConf = new ArrayCollection([{headerText: "企业", dataField: "label", width: "100", textAlign: "left", sortable: true, draggable: true}, {headerText: "总投资(万元)", dataField: "vol1", width: "90", textAlign: "center", sortable: true, draggable: true}, {headerText: "完成投资(万元)", dataField: "vol2", width: "90", textAlign: "center", sortable: true, draggable: true}, {headerText: "未完成投资(万元)", dataField: "vol3", width: "90", textAlign: "center", sortable: true, draggable: true}, {headerText: "投资完成率(%)", dataField: "vol4", width: "90", textAlign: "center", sortable: true, draggable: true}, {headerText: "平均完成率(%)", dataField: "vol5", width: "90", textAlign: "center", sortable: true, draggable: true}]);
				
				try
				{
					var tmpArrayCollection:ArrayCollection = new ArrayCollection();
					var tmpArrayCollection2:ArrayCollection = new ArrayCollection();
					var tmpList:XMLList;
					if (tab2_plateCurrSelect == "00")
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.investmentdata.corpData;
					}
					else
					{
						tmpList = hseDataXML.corpCompare.dataset.(@typeid == "ALL-LEVEL").plateData.(@plateid == tab2_plateCurrSelect).investmentdata.corpData;
					}
					
					if (tmpList != null && tmpList.length() > 0)
					{
						var vol1_sum:Number = 0;
						var vol2_sum:Number = 0;
						var vol3_sum:Number = 0;
						var vol4_sum:Number = 0;
						var vol5_sum:Number = 0;
						var index:int = 2;
						for each (var xml:XML in tmpList)
						{
							var obj:Object = {label: xml.@subCorpname, vol1: Number(xml.@investment), vol2: Number(xml.@finishedInvestment), vol3: Number(xml.@unfinishedInvestment), vol4: Number(xml.@finishedRation), vol5: Number(xml.@averageFinishedRation), index: index}
							tmpArrayCollection.addItem(obj);
							index++;
							
							vol1_sum += Number(obj.vol1);
							vol2_sum += Number(obj.vol2);
							vol3_sum += Number(obj.vol3);
						}
						vol4_sum = (vol1_sum == 0) ? 0 : vol2_sum * 100 / vol1_sum;
						
						vol1_sum = Number(vol1_sum.toFixed(2));
						vol2_sum = Number(vol2_sum.toFixed(2));
						vol3_sum = Number(vol3_sum.toFixed(2));
						vol4_sum = Number(vol4_sum.toFixed(2));
						
						var obj_total:Object = {label: tab2_plateNameCurrSelect + "合计", vol1: vol1_sum, vol2: vol2_sum, vol3: vol3_sum, vol4: vol4_sum, vol5: vol4_sum, index: 1}
						tmpArrayCollection2.addItem(obj_total);
						
						var sort:Sort = new Sort();
						sort.fields = [new SortField("vol4", true, true)];
						tmpArrayCollection.sort = sort;
						tmpArrayCollection.refresh();
						
						var order2:int = 1;
						for each (var obj2:Object in tmpArrayCollection)
						{
							obj2.order = order2;
							tmpArrayCollection2.addItem(obj2);
							order2++;
						}
					}
					
					titleWindow.DataSource = tmpArrayCollection2;
				}
				catch (e:Event)
				{
					trace(e);
				}
				
				PopUpManager.addPopUp(titleWindow, this, true);
				PopUpManager.centerPopUp(titleWindow);
			}
			
			public function get DateStr():String
			{
				return dateStr;
			}
			
			public function set DateStr(value:String):void
			{
				if (value != dateStr)
				{
					dateStrChanged = true;
					dateStr = value;
					dateStrName = dateStr.substr(0, 4) + "年" + dateStr.substr(5, 2) + "月";
					invalidateProperties();
				}
			}
			public function get ShowDataLabel():Boolean{
				return showDataLabel;
			}
			public function set ShowDataLabel(value:Boolean):void{
				showDataLabel = value;
				executeBind();
			}
			override protected function commitProperties():void
			{
				super.commitProperties();
				if (!isFirstLoad)
				{
					if (dateStrChanged)
					{
						dateStrChanged = false;
						refreshData();
							//invalidateDisplayList();  // invalidate in case the titles 
						
					}
				}
			}
			
			protected function radiobutton1_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				this.tab1_plateCurrSelect = RadioButton(event.target).value.toString();
				this.tab1_plateNameCurrSelect = RadioButton(event.target).label;
				this.tab1_plateNameCurrSelect = tab1_plateNameCurrSelect == null ? "" : tab1_plateNameCurrSelect;
				tab1_corpDS = getTab1_corpDS();
				tab1_topLeftDS = gettab1_topLeftDS();
				tab1_topRightDS = gettab1_topRightDS();
				tab1_downLeftDS = gettab1_downLeftDS();
				tab1_downRightDS = gettab1_downRightDS();
				executeBindTab1Title();
			
			}
			
//			protected function radiobutton2_clickHandler(event:MouseEvent):void
//			{
//				// TODO Auto-generated method stub
//				this.tab1_corpCurrSelect=RadioButton(event.target).value.toString();
//				this.tab1_corpNameCurrSelect=RadioButton(event.target).label;
//				this.tab1_corpNameCurrSelect=tab1_corpNameCurrSelect==null?"":tab1_corpNameCurrSelect;
//				tab1_topLeftDS=gettab1_topLeftDS();
//				tab1_topRightDS=gettab1_topRightDS();
//				tab1_downLeftDS=gettab1_downLeftDS();				
//				tab1_downRightDS=gettab1_downRightDS();	
//				executeBindTab1Title();	
//			}
			protected function tab1_corpRep_changeHandler(event:IndexChangeEvent):void
			{
				// TODO Auto-generated method stub
				this.tab1_corpCurrSelect = tab1_corpRep.selectedItem.value;
				this.tab1_corpNameCurrSelect = tab1_corpRep.selectedItem.label;
				this.tab1_corpNameCurrSelect = tab1_corpNameCurrSelect == null ? "" : tab1_corpNameCurrSelect;
				tab1_topLeftDS = gettab1_topLeftDS();
				tab1_topRightDS = gettab1_topRightDS();
				tab1_downLeftDS = gettab1_downLeftDS();
				tab1_downRightDS = gettab1_downRightDS();
				executeBindTab1Title();
			}
			
			protected function radiobutton3_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
				this.tab2_plateCurrSelect = RadioButton(event.target).value.toString();
				this.tab2_plateNameCurrSelect = RadioButton(event.target).label;
				this.tab2_plateNameCurrSelect = tab2_plateNameCurrSelect == null ? "" : tab2_plateNameCurrSelect;
				
				tab2_showCorpCnt = getTab2_CorpCntDS();
				tab2_showCorpCntMax = getTab2_CorpCntMax();
				
				tab2_topLeftDS = gettab2_topLeftDS();
				tab2_topRightDS = gettab2_topRightDS();
				tab2_downLeftDS = gettab2_downLeftDS();
				tab2_downRightDS = gettab2_downRightDS();
				executeBindTab2Title();
			
			}
			
			protected function numericstepper1_changeHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				tab2_showCorpCnt = int(NumericStepper(event.target).value);
				tab2_topLeftDS = gettab2_topLeftDS();
				tab2_topRightDS = gettab2_topRightDS();
				tab2_downLeftDS = gettab2_downLeftDS();
				tab2_downRightDS = gettab2_downRightDS();
				executeBindTab2Title();
			}
			
			protected function tab1_PopupDoubleClickHandler(event:PopupEvent):void
			{
				// TODO Auto-generated method stub
				popupMX();
			}
			
			protected function tab2_top_PopupDoubleClickHandler(event:PopupEvent):void
			{
				// TODO Auto-generated method stub
				popupMX2_proj();
			}
			
			protected function tab2_down_PopupDoubleClickHandler(event:PopupEvent):void
			{
				// TODO Auto-generated method stub
				popupMX2_investment();
			}
			
			private var tab1_corpDS_temp:ArrayCollection = new ArrayCollection();
			protected function search_clickHandler():void
			{
				tab1_corpDS_temp.removeAll();
				var text:String =  gyText.text;
				if(text!=""&&text!=null){
					for(var i:int=0;i<tab1_corpDS.length;i++){
						if(tab1_corpDS[i].label.indexOf(text)!=-1){
							tab1_corpDS_temp.addItem(tab1_corpDS[i]);
						}
					}
					tab1_corpRep.dataProvider = tab1_corpDS_temp;
				}else{
					tab1_corpRep.dataProvider = tab1_corpDS;
				}
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
		<fx:XML id="hseDataXML" />
		<mx:WebService id="ws"
					   showBusyCursor="true"
					   result="ws_resultHandler(event)"
					   fault="ws_faultHandler(event)" />
		<s:RadioButtonGroup id="tab1_plateGrp" />
		<s:RadioButtonGroup id="tab1_corpGrp" />
		<s:RadioButtonGroup id="tab2_plateGrp" />
		<mx:DefaultListEffect color="0xccccff" fadeOutDuration="2000" id="glow"/>
		<mx:Sequence id="itemsChangeEffect">
			
			<!--<mx:WipeDown duration="500"/>-->
			<mx:Parallel>
				<mx:Move duration="750" easingFunction="{Elastic.easeOut}" perElementOffset="20"/>
				<mx:RemoveItemAction startDelay="400" filter="removeItem"/>
				<mx:AddItemAction startDelay="400" filter="addItem"></mx:AddItemAction>
				<mx:Blur startDelay="410" blurXFrom="18" blurYFrom="18" blurXTo="0" blurYTo="0" duration="300" filter="addItem"/>
			</mx:Parallel>
		</mx:Sequence>
	</fx:Declarations>
	<s:layout>
		<s:VerticalLayout horizontalAlign="left"
						  verticalAlign="middle"
						  gap="0" />
	</s:layout>
	<s:BorderContainer width="100%" height="35" styleName="tabHead2Box">
		<s:layout>
			<s:BasicLayout />
		</s:layout>
		<s:ButtonBar id="buttonBar" dataProvider="{viewStack}" height="25" styleName="tabButtonStyle2" right="5" top="5"/>
	</s:BorderContainer>
	<mx:ViewStack id="viewStack"
				  width="100%"
				  height="100%"
				  y="{buttonBar.height+5-1}"
				  styleName="tabContentBox"
				  borderStyle="inset"
				  left="5"
				  right="5"
				  creationPolicy="auto">
		<s:NavigatorContent width="100%"
							height="100%"
							label="{tab1_title}">
			<s:layout>
				<s:VerticalLayout horizontalAlign="left"
								  verticalAlign="middle"
								  gap="0" />
			</s:layout>
			<s:HGroup width="100%"
					  height="30"
					  horizontalAlign="center"
					  gap="-1">
				<s:BorderContainer width="100%" height="35" styleName="tabHead2Box">
					<s:layout>
						<s:HorizontalLayout horizontalAlign="right"
											verticalAlign="middle" />
					</s:layout>
					<mx:HBox borderStyle="outset"
							 styleName="controlBox"
							 paddingLeft="10"
							 paddingRight="10">
						<mx:Repeater id="tab1_plateRep"
									 dataProvider="{tab1_plateDS}">
							<s:RadioButton groupName="tab1_plateGrp"
										   label="{tab1_plateRep.currentItem.label}"
										   value="{tab1_plateRep.currentItem.value}"
										   selected="{tab1_plateRep.currentItem.value==tab1_plateCurrSelect}"
										   click="radiobutton1_clickHandler(event)" />
						</mx:Repeater>
					</mx:HBox>
				</s:BorderContainer>
			</s:HGroup>
			<s:HGroup width="100%"
					  height="100%"
					  horizontalAlign="center"
					  gap="-1">
				<s:HGroup width="140"
						  height="100%"
						  horizontalAlign="center"
						  verticalAlign="top"
						  gap="-1">
					<mx:VBox width="100%"
							 height="100%"
							 horizontalAlign="left">
						<s:Spacer width="2"/>
						<s:HGroup>
							<s:TextInput width="110" height="21" id="gyText" fontFamily="Microsoft YaHei" contentBackgroundColor="#E7E1D3" borderColor="#000000"/>
							<s:Image source="assets/images/serch.png" buttonMode="true" click="search_clickHandler()" toolTip="单位检索"/>
						</s:HGroup>
						
						<s:List id="tab1_corpRep"
								width="100%"
								height="100%"
								selectedIndex="0"
								dataProvider="{tab1_corpDS}"
								change="tab1_corpRep_changeHandler(event)">
						</s:List>
					</mx:VBox>
				</s:HGroup>
				<s:VGroup width="100%"
						  height="100%"
						  horizontalAlign="center"
						  verticalAlign="top"
						  gap="-1">
					<s:HGroup width="100%"
							  height="30%"
							  horizontalAlign="center"
							  verticalAlign="top"
							  gap="-1">
						<s:BorderContainer width="100%"
										   height="100%"
										   styleName="contentBox">
							<s:layout>
								<s:VerticalLayout paddingLeft="5"
												  paddingTop="5"
												  paddingBottom="5"
												  paddingRight="5"
												  horizontalAlign="justify" />
							</s:layout>
							<views:BarSubTotalMulti id="tab1_topLeft"
													width="100%"
													height="100%"
													showTitle="true"
													showLegend="false"
													xAxisAt="top"
													yAxisAt="left" ShowDataLabel="{showDataLabel}"
													title="{tab1_topLeftTitle}"
													DataSourceConf="{tab1_topLeftConfDS}"
													DataSource="{tab1_topLeftDS}"
													PopupDoubleClick="tab1_PopupDoubleClickHandler(event)" />
						</s:BorderContainer>
						<s:BorderContainer width="100%"
										   height="100%"
										   styleName="contentBox">
							<s:layout>
								<s:VerticalLayout paddingLeft="5"
												  paddingTop="5"
												  paddingBottom="5"
												  paddingRight="5"
												  horizontalAlign="justify" />
							</s:layout>
							<views:BarSubTotalMulti id="tab1_topRight"
													width="100%"
													height="100%"
													showTitle="true"
													showLegend="false"
													xAxisAt="top"
													yAxisAt="left" ShowDataLabel="{showDataLabel}"
													title="{tab1_topRightTitle}"
													DataSourceConf="{tab1_topRightConfDS}"
													DataSource="{tab1_topRightDS}"
													PopupDoubleClick="tab1_PopupDoubleClickHandler(event)" />
						</s:BorderContainer>
					</s:HGroup>
					<s:HGroup width="100%"
							  height="70%"
							  horizontalAlign="center"
							  verticalAlign="top"
							  gap="-1">
						<s:BorderContainer width="100%"
										   height="100%"
										   styleName="contentBox">
							<s:layout>
								<s:VerticalLayout paddingLeft="5"
												  paddingTop="5"
												  paddingBottom="5"
												  paddingRight="5"
												  horizontalAlign="justify" />
							</s:layout>
							<views:BarSubTotalMulti id="tab1_downLeft"
													width="100%"
													height="100%"
													showTitle="false"
													showLegend="true"
													xAxisAt="top"
													yAxisAt="left" ShowDataLabel="{showDataLabel}"
													DataSourceConf="{tab1_downLeftConfDS}"
													DataSource="{tab1_downLeftDS}"
													PopupDoubleClick="tab1_PopupDoubleClickHandler(event)" />
						</s:BorderContainer>
						<s:BorderContainer width="100%"
										   height="100%"
										   styleName="contentBox">
							<s:layout>
								<s:VerticalLayout paddingLeft="5"
												  paddingTop="5"
												  paddingBottom="5"
												  paddingRight="5"
												  horizontalAlign="justify" />
							</s:layout>
							<views:BarSubTotalMulti id="tab1_downRight"
													width="100%"
													height="100%"
													showTitle="false"
													showLegend="true"
													xAxisAt="top"
													yAxisAt="left" ShowDataLabel="{showDataLabel}"
													DataSourceConf="{tab1_downRightConfDS}"
													DataSource="{tab1_downRightDS}"
													PopupDoubleClick="tab1_PopupDoubleClickHandler(event)" />
						</s:BorderContainer>
					</s:HGroup>
				</s:VGroup>
			</s:HGroup>
		</s:NavigatorContent>

		<s:NavigatorContent width="100%"
							height="100%"
							label="{tab2_title}">
			<s:layout>
				<s:VerticalLayout horizontalAlign="left"
								  verticalAlign="middle"
								  gap="0" />
			</s:layout>
			<s:HGroup width="100%"
					  height="30"
					  horizontalAlign="center"
					  gap="-1">
				<s:BorderContainer width="100%" height="35" styleName="tabHead2Box">
					<s:layout>
						<s:HorizontalLayout horizontalAlign="right"
											verticalAlign="middle" />
					</s:layout>
					<mx:HBox borderStyle="outset"
							 styleName="controlBox"
							 paddingLeft="10"
							 paddingRight="10">
						<mx:Repeater id="tab2_plateRep"
									 dataProvider="{tab2_plateDS}">
							<s:RadioButton groupName="tab2_plateGrp"
										   label="{tab2_plateRep.currentItem.label}"
										   value="{tab2_plateRep.currentItem.value}"
										   selected="{tab2_plateRep.currentItem.value==tab2_plateCurrSelect}"
										   click="radiobutton3_clickHandler(event)" />
						</mx:Repeater>
					</mx:HBox>
					<s:Label text="显示企业数" />
					<mx:NumericStepper id="numericstepper1"
									   value="{tab2_showCorpCnt}"
									   minimum="0"
									   maximum="{tab2_showCorpCntMax}"
									   color="#000000"
									   change="numericstepper1_changeHandler(event)" />
				</s:BorderContainer>
			</s:HGroup>
			<s:VGroup width="100%"
					  height="100%"
					  horizontalAlign="center"
					  gap="-1">
				<s:HGroup width="100%"
						  height="100%"
						  horizontalAlign="center"
						  verticalAlign="top"
						  gap="-1">
					<s:BorderContainer width="100%"
									   height="100%"
									   styleName="contentBox">
						<s:layout>
							<s:VerticalLayout paddingLeft="5"
											  paddingTop="5"
											  paddingBottom="5"
											  paddingRight="5"
											  horizontalAlign="justify" />
						</s:layout>
						<views:ColumnLineMulti id="tab2_topLeft"
											   labelRotationX="45"
											   width="100%"
											   height="100%"
											   showTitle="true"
											   AxisLeftUnit="%"
											   showLegend="true" ShowDataLabel="{showDataLabel}"
											   title="{tab2_topLeftTitle}"
											   DataSourceConf="{tab2_topLeftConfDS}"
											   DataSource="{tab2_topLeftDS}"
											   PopupDoubleClick="tab2_top_PopupDoubleClickHandler(event)" />
					</s:BorderContainer>
					<s:BorderContainer width="100%"
									   height="100%"
									   styleName="contentBox">
						<s:layout>
							<s:VerticalLayout paddingLeft="5"
											  paddingTop="5"
											  paddingBottom="5"
											  paddingRight="5"
											  horizontalAlign="justify" />
						</s:layout>
						<views:ColumnLineMulti id="tab2_topRight"
											   labelRotationX="45"
											   width="100%"
											   height="100%"
											   showTitle="true"
											   AxisLeftUnit="%"
											   showLegend="true" ShowDataLabel="{showDataLabel}"
											   title="{tab2_topRightTitle}"
											   DataSourceConf="{tab2_topRightConfDS}"
											   DataSource="{tab2_topRightDS}"
											   PopupDoubleClick="tab2_top_PopupDoubleClickHandler(event)" />
					</s:BorderContainer>
				</s:HGroup>
				<s:HGroup width="100%"
						  height="100%"
						  horizontalAlign="center"
						  verticalAlign="top"
						  gap="-1">
					<s:BorderContainer width="100%"
									   height="100%"
									   styleName="contentBox">
						<s:layout>
							<s:VerticalLayout paddingLeft="5"
											  paddingTop="5"
											  paddingBottom="5"
											  paddingRight="5"
											  horizontalAlign="justify" />
						</s:layout>
						<views:ColumnLineMulti id="tab2_downLeft"
											   labelRotationX="45"
											   width="100%"
											   height="100%"
											   showTitle="true"
											   AxisLeftUnit="%"
											   showLegend="true" ShowDataLabel="{showDataLabel}"
											   title="{tab2_downLeftTitle}"
											   DataSourceConf="{tab2_downLeftConfDS}"
											   DataSource="{tab2_downLeftDS}"
											   PopupDoubleClick="tab2_down_PopupDoubleClickHandler(event)" />
					</s:BorderContainer>
					<s:BorderContainer width="100%"
									   height="100%"
									   styleName="contentBox">
						<s:layout>
							<s:VerticalLayout paddingLeft="5"
											  paddingTop="5"
											  paddingBottom="5"
											  paddingRight="5"
											  horizontalAlign="justify" />
						</s:layout>
						<views:ColumnLineMulti id="tab2_downRight"
											   labelRotationX="45"
											   width="100%"
											   height="100%"
											   showTitle="true"
											   AxisLeftUnit="%"
											   showLegend="true" ShowDataLabel="{showDataLabel}"
											   title="{tab2_downRightTitle}"
											   DataSourceConf="{tab2_downRightConfDS}"
											   DataSource="{tab2_downRightDS}"
											   PopupDoubleClick="tab2_down_PopupDoubleClickHandler(event)" />
					</s:BorderContainer>
				</s:HGroup>
			</s:VGroup>
		</s:NavigatorContent>

	</mx:ViewStack>


</s:Group>
